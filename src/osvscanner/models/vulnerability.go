package models

import "time"

// Package идентифицирует затронутую библиотеку кода или команду, предоставленную пакетом.
//
// Подробнее: https://ossf.github.io/osv-schema/#affectedpackage-field
type Package struct {
	Ecosystem Ecosystem `json:"ecosystem"      yaml:"ecosystem"`
	Name      string    `json:"name"           yaml:"name"`
}

// Event описывает одну версию, которая либо:
//
// - Представляет уязвимость: {"introduced": string}
// - Исправляет уязвимость: {"fixed": string}
// - Описывает последнюю известную затронутую версию: {"last_affected": string}
// - Устанавливает верхний предел описываемого диапазона: {"limit": string}
//
// Экземпляры событий составляют часть «временной шкалы» изменений статуса затронутых пакетов,
// описанных Affected struct.
//
// Подробнее: https://ossf.github.io/osv-schema/#affectedrangesevents-fields
type Event struct {
	Introduced   string `json:"introduced,omitempty"    yaml:"introduced,omitempty"`
	Fixed        string `json:"fixed,omitempty"         yaml:"fixed,omitempty"`
	LastAffected string `json:"last_affected,omitempty" yaml:"last_affected,omitempty"`
	Limit        string `json:"limit,omitempty"         yaml:"limit,omitempty"`
}

// Range описывает диапазон, на который влияет данная версия для конкретного пакета.
//
// Подробнее: https://ossf.github.io/osv-schema/#affectedranges-field
type Range struct {
	Type             RangeType              `json:"type"                        yaml:"type"`
	Events           []Event                `json:"events"                      yaml:"events"`
	Repo             string                 `json:"repo,omitempty"              yaml:"repo,omitempty"`
	DatabaseSpecific map[string]interface{} `json:"database_specific,omitempty" yaml:"database_specific,omitempty"`
}

// Severity используется для описания серьезности уязвимости затронутого пакета с использованием
// одного или нескольких методов количественной оценки.
// Подробнее: https://ossf.github.io/osv-schema/#severity-field
type Severity struct {
	Type  SeverityType `json:"type"  yaml:"type"`
	Score string       `json:"score" yaml:"score"`
}

// Affected описывает затронутую версию пакета, то есть один экземпляр, содержащий уязвимость.
//
// Подробнее: https://ossf.github.io/osv-schema/#affected-fields
type Affected struct {
	Package           Package                `json:"package,omitempty"            yaml:"package,omitempty"`
	Severity          []Severity             `json:"severity,omitempty"           yaml:"severity,omitempty"`
	Ranges            []Range                `json:"ranges,omitempty"             yaml:"ranges,omitempty"`
	Versions          []string               `json:"versions,omitempty"           yaml:"versions,omitempty"`
	DatabaseSpecific  map[string]interface{} `json:"database_specific,omitempty"  yaml:"database_specific,omitempty"`
	EcosystemSpecific map[string]interface{} `json:"ecosystem_specific,omitempty" yaml:"ecosystem_specific,omitempty"`
}

// Reference описывает ссылки на дополнительную информацию, рекомендации,
// записи системы отслеживания проблем и т.д. о самой уязвимости.
//
// Подробнее: https://ossf.github.io/osv-schema/#references-field
type Reference struct {
	Type string `json:"type" yaml:"type"`
	URL  string `json:"url"  yaml:"url"`
}

// Vulnerability это основной тип данных об уязвимостях с открытым исходным кодом (OSV).
//
// Подробнее: https://ossf.github.io/osv-schema
type Vulnerability struct {
	SchemaVersion string      `json:"schema_version,omitempty"    yaml:"schema_version,omitempty"`
	ID            string      `json:"id"                          yaml:"id"`
	Modified      time.Time   `json:"modified"                    yaml:"modified"`
	Published     time.Time   `json:"published,omitempty"         yaml:"published,omitempty"`
	Aliases       []string    `json:"aliases,omitempty"           yaml:"aliases,omitempty"`
	Summary       string      `json:"summary,omitempty"           yaml:"summary,omitempty"`
	Details       string      `json:"details,omitempty"           yaml:"details,omitempty"`
	Affected      []Affected  `json:"affected,omitempty"          yaml:"affected,omitempty"`
	Severity      []Severity  `json:"severity,omitempty"          yaml:"severity,omitempty"`
	References    []Reference `json:"references,omitempty"        yaml:"references,omitempty"`
}
